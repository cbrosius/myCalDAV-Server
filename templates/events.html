{% extends "base.html" %}

{% block title %}Events - My CalDAV Server{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Events</h1>
    <a href="/web/events/new" class="btn btn-primary">+ New Event</a>
</div>

<div class="filters">
    <div class="filter-group">
        <label for="calendar-filter">Filter by Calendar:</label>
            <select id="calendar-filter" onchange="filterByCalendar(this.value)">
            <option value="">All Calendars</option>
            {% for cal in calendars %}
            <option value="{{ cal.id }}" {% if self.is_calendar_selected(cal.id) %}selected{% endif %}>
                {{ cal.name }}
            </option>
            {% endfor %}
        </select>
    </div>
</div>

{% if events.is_empty() %}
    <div class="empty-state">
        <div class="empty-icon">üìå</div>
        <h2>No events found</h2>
        <p>Create your first event to get started.</p>
        <a href="/web/events/new" class="btn btn-primary">Create Event</a>
    </div>
{% else %}
    <div class="event-list">
        {% for event in events %}
        <div class="event-item" data-calendar="{{ event.calendar_id }}">
            <div class="event-date">
                <span class="event-day">{{ event.start_time.format("%d") }}</span>
                <span class="event-month">{{ event.start_time.format("%b") }}</span>
            </div>
            <div class="event-info">
                <h4>
                    <a href="/web/events/{{ event.id }}/edit">{{ event.title }}</a>
                </h4>
                <p class="event-time">
                    {{ event.start_time.format("%Y-%m-%d %H:%M") }} - 
                    {{ event.end_time.format("%H:%M") }}
                </p>
                {% match event.location %}
                    {% when Some with (loc) %}
                        <p class="event-location">üìç {{ loc }}</p>
                    {% when None %}
                {% endmatch %}
                <p class="event-calendar">
                    üìÖ {% match calendar_names.get(event.calendar_id) %}{% when Some with (n) %}{{ n }}{% when None %}Unknown{% endmatch %}
                </p>
            </div>
            <div class="event-actions">
                <a href="/web/events/{{ event.id }}/edit" class="btn btn-sm btn-outline">Edit</a>
                <form action="/web/events/{{ event.id }}/delete" method="post" class="inline-form"
                      onsubmit="return confirm('Are you sure you want to delete this event?');">
                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    function filterByCalendar(calendarId) {
        if (calendarId) {
            window.location.href = '/web/events?calendar=' + calendarId;
        } else {
            window.location.href = '/web/events';
        }
    }
</script>
{% endblock %}
